

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Introduction and Measurement Set Preparation &mdash; visread 0.0.4 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Visread API" href="api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> visread
          

          
          </a>

          
            
            
              <div class="version">
                0.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorials/introduction_to_casatools.html">Introduction to CASA tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/rescale_AS209_weights.html">Walkthrough: Examining DSHARP AS 209 Weights and Exporting Visibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Visread Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Visread API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction and Measurement Set Preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-does-this-package-exist">Why does this package exist?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-your-measurement-set">Preparing your measurement set</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">visread</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Introduction and Measurement Set Preparation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/introduction_to_spectral_lines.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="introduction-and-measurement-set-preparation">
<h1>Introduction and Measurement Set Preparation<a class="headerlink" href="#introduction-and-measurement-set-preparation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-does-this-package-exist">
<h2>Why does this package exist?<a class="headerlink" href="#why-does-this-package-exist" title="Permalink to this headline">¶</a></h2>
<p>Frequently, radio astronomers might like to work directly with the visibility data themselves to make publication-quality plots of the baseline distributions, fit visibility-plane models, or experiment with alternative imaging algorithms. <a class="reference external" href="https://casa.nrao.edu/casadocs-devel/stable">CASA</a> is the facility software reduction package for many radio telescopes (including ALMA and the VLA), and radio datasets are stored in the standard <a class="reference external" href="https://casa.nrao.edu/casadocs-devel/stable/casa-fundamentals">Measurement Set format</a>. Until recently, because of the monolithic nature of CASA releases, it was very difficult for a user to directly access the visibilities inside of their own Python programs.</p>
<p>The situation has vastly improved with the release of the <a class="reference external" href="https://casa.nrao.edu/casadocs-devel/stable/usingcasa/obtaining-and-installing">CASA 6.x modular installations</a>, allowing a user to <cite>pip</cite> install the <cite>casatools</cite> package directly into their own Python environment. However, the series of commands needed to extract visibilities from a measurement set is still comparatively low-level and only sparsely documented. This package is meant to serve as a small piece of glue to extract the visibilities from a calibrated and processed Measurement Set and return them to the user in a well-documented format.</p>
</div>
<div class="section" id="preparing-your-measurement-set">
<h2>Preparing your measurement set<a class="headerlink" href="#preparing-your-measurement-set" title="Permalink to this headline">¶</a></h2>
<p>One of the great (but also very tricky) things about the Measurement Set format is that its internal structure can assume complex layouts necessary to represent the diversity of raw data formats from single-dish radio telescopes and interferometric arrays. The many choices involved with distilling this complexity down is probably one of the reasons an <code class="docutils literal notranslate"><span class="pre">export_visibilities</span></code> function doesn’t yet exist within CASA itself.</p>
<p>We envision <em>visread</em> as a wrapper script for simple operations to read calibrated visibilities from a measurement set with a simple, minimal format. By that, we mean</p>
<ul class="simple">
<li><p>one spectral window</p></li>
<li><p>one target</p></li>
<li><p>if the spectral window contains many channels, it has been truncated to include only those with data that you want to analyze.</p></li>
<li><p>only XX or only XX and YY linear polarizations</p></li>
</ul>
<p>This means that before turning to <em>visread</em>, the user will want to spend some time with CASA familiarizing themselves with their data. If, as is usually the case, their measurement set does not meet the criteria above but contains multiple spectral windows or targets (such as calibrators), they will want to spend some time explicitly making the reduction choices themselves to get their visibilities into this minimal format. You’ll want to use CASA commands like <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-5-1.2/uv-manipulation/splitting-out-calibrated-uv-data-split">split</a>, <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-5.4.1/uv-manipulation/manipulating-visibilities-with-mstransform">mstransform</a>, and <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-6.1.0/global-task-list/task_cvel2/about">cvel2</a> to first subselect those visibilities you want (possibly average them) and create a new measurement set containing only them.</p>
<p>Even if your are not planning to export your visibilities with <em>visread</em>, it’s still nice to have a copy of your calibrated and reduced data in such a minimal format. The idea is that you could run a minimal <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-6.1.0/global-task-list/task_tclean/about">tclean command</a> to produce your image or channel maps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s2">&quot;minimial_vis.ms&quot;</span><span class="p">,</span>
    <span class="n">imagename</span><span class="o">=</span><span class="s2">&quot;myImage&quot;</span><span class="p">,</span>
    <span class="n">imsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="s2">&quot;0.02arcsec&quot;</span><span class="p">,</span>
    <span class="n">specmode</span><span class="o">=</span><span class="s2">&quot;cube&quot;</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;briggs&quot;</span><span class="p">,</span>
    <span class="n">robust</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>without needing to subselect portions of your measurement set using <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-6.1.0/global-task-list/task_tclean/about">tclean</a> subparameters like <code class="docutils literal notranslate"><span class="pre">field</span></code>, <code class="docutils literal notranslate"><span class="pre">spw</span></code>, <code class="docutils literal notranslate"><span class="pre">timerange</span></code>, <code class="docutils literal notranslate"><span class="pre">uvrange</span></code>, <code class="docutils literal notranslate"><span class="pre">antenna</span></code>, <code class="docutils literal notranslate"><span class="pre">scan</span></code>, <code class="docutils literal notranslate"><span class="pre">observation</span></code>, <code class="docutils literal notranslate"><span class="pre">intent</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">nchan</span></code>, or <code class="docutils literal notranslate"><span class="pre">outframe</span></code>, because these transformations would already have been accomplished with <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-5-1.2/uv-manipulation/splitting-out-calibrated-uv-data-split">split</a>, <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-5.4.1/uv-manipulation/manipulating-visibilities-with-mstransform">mstransform</a>, and/or <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-6.1.0/global-task-list/task_cvel2/about">cvel2</a>. Once you’ve created this minimal measurement set to use with <em>visread</em>, it is an <strong>excellent</strong> idea to first image it using <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-6.1.0/global-task-list/task_tclean/about">tclean</a> to make sure it actually contains the visibilities as you wanted them processed.</p>
<p>The idea behind this workflow is to use the CASA facility software package for what it’s designed for (processing radio interferometry data in the measurement set format) and to put any decisions about data averaging or subselection explicitly in the hands of the user (rather than incorrectly assuming what they want within <em>visread</em>). If you want to preserve some of the distincitions in the measurement set in your exported visibilities (if, for example, it was very important to preserve which spectral window each visibility came from), we would recommend making a separate minimal measurement set for each spectral window and using <em>visread</em> to read those individually.</p>
<p>If your data is more complicated than can be represented in our version of a minimal format, then we would recommend using the CASA6 <em>casatools</em> directly to access your data at a lower level. You may find inspiration by looking at the <a class="reference external" href="https://github.com/MPoL-dev/visread/blob/main/src/visread/visread.py">source code</a> of the <code class="docutils literal notranslate"><span class="pre">visread.read</span></code> function.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="api.html" class="btn btn-neutral float-left" title="Visread API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ian Czekala.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>